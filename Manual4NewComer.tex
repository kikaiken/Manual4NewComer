\documentclass[a4paper,titlepage,here]{ujarticle}
\usepackage[top=20truemm,bottom=20truemm,left=10truemm,right=10truemm]{geometry}
\usepackage{color}
\usepackage{colortbl}
\usepackage{graphicx}
\usepackage{float}

\title{京都大学　機械研究会　新入生教本}
\date{\today}
\author{松岡　航太郎\\29年度機械研究会同期一同}

\begin{document}
\maketitle
\section{抵抗}
回路の基礎中の基礎。電流の制限、分圧やプルアップなど、様々な用途に用いる。この節では用途ではなく抵抗選定のための知識に主眼を置く。
\subsection{抵抗値の表記方法}
\subsection{カラーコード}
カーボン抵抗などのリード線のついた抵抗には、カラーコードと呼ばれる色のついた帯が印刷されている。必ずしも暗記する必要はない(暗記しなくても済むように整理しておく方が有意義である)が、よく使う抵抗値についてはばらまく可能性も高いので覚えておくことが好ましい。

各色の意味は以下の通りである。

\begin{table}[H]
	\begin{tabular}{|cc|c|c|c|}\hline
		色&&数値&乗率&精度\\ \hline
		無&&N/A&N/A&$\pm$20\%\\ \hline
		桃&\cellcolor[rgb]{1,0.412,0.706}{　}&N/A&$10^{-3}$&N/A\\ \hline
		銀&\cellcolor[rgb]{0.753,0.753,0.753}{　}&N/A&$10^{-2}$&$\pm$10\%\\ \hline
		金&\cellcolor[rgb]{0.812,0.71,0.231}{　}&N/A&$10^{-1}$&$\pm$5\%\\ \hline
		黒&\cellcolor{black}{　}&0&1&N/A\\ \hline
		茶&\cellcolor[rgb]{0.647059,0.164706,0.164706}{　}&1&10&$\pm$1\%\\ \hline
		赤&\cellcolor{red}{　}&2&$10^2$&$\pm$2\%\\ \hline
		橙&\cellcolor[rgb]{0.894118,0.368627,0}{　}&3&$10^3$&$\pm$3\% \\ \hline
		黄&\cellcolor{yellow}{　}&4&$10^4$&$\pm$5\%\\ \hline
		緑&\cellcolor{green}{　}&5&$10^5$&$\pm$0.5\%\\ \hline
		青&\cellcolor{blue}{　}&6&$10^6$&$\pm$0.25\%\\ \hline
		紫&\cellcolor[rgb]{0.58,0,0.827}{　}&7&$10^7$&$\pm$0.1\%\\ \hline
		灰&\cellcolor[rgb]{0.627,0.627,0.627}{　}&8&$10^8$&$\pm$0.05\%\\ \hline
		白&\cellcolor[rgb]{1,1,1}{　}&9&$10^9$&$\pm$0.025\%\\ \hline
	\end{tabular}
\end{table}
\subsubsection{コード表記}
チップ抵抗やセメント抵抗においてはカラーコードではなく、数字とアルファベットによって表記される。
\subsection{用途}
\subsubsection{制限抵抗}
LEDなどほとんど抵抗がないが電力を消費する素子では抵抗によって流れる電流を制限しないと焼けてしまうため、適当な値の抵抗をいれてやる被強うがある。
\subsubsection{分圧}
電圧を簡易的に下げたい場合には、与える電圧と得たい電圧の比に合うように抵抗を２つ直列に繋いでその接点を出力とすることで電圧を下げることができる。

負荷をつないだり、温度が変化したりすると電圧値が変化するので簡易的でしかない。

5V系から3.3V系へ通信するときなどに使う。
\subsection{プルアップ抵抗}
\subsection{プルダウン抵抗}
\subsection{種類}
一口に抵抗といっても、材質や用途によって区別される。ここではそれらの抵抗の種類について述べる。
\subsubsection{カーボン抵抗}
最も一般的な抵抗。精度は5\%程度で温度特性も悪いが安価であるためよく使われる。1/4W程度の定格電力であることが多い。
\subsubsection{金属皮膜抵抗}
精度は1\%以下であることが多く、温度特性もよいが、カーボン抵抗よりは高価である。分圧する場合などに精度が欲しいときは使うことになるだろう。1/8Wなど、カーボン抵抗よりも定格電力が低い傾向がある。
\subsubsection{セメント抵抗}
W単位の大電力を流したい場合に使用する。
\subsubsection{チップ抵抗}
面実装をするための抵抗のことを示す。
\subsubsection{シャント抵抗}
シャント(shunt)は英語では並列接続のことを意味するが、シャント抵抗といった場合は電流計に用いるための低抵抗、高精度、高定格電力な抵抗のことを言う。
\section{コンデンサ}
コンデンサは短期的に電気をためることができる素子である。(英語ではキャパシタということが多い)
\subsection{用途}
\subsubsection{パスコン}
少なくとも機械研究会において、最も多く用いる用途はパスコンであろう。パスコンとは、ICやモーターのできる限り近くの電源線とグラウンドの間にコンデンサを設置することで、電源線に伝わる高周波のノイズをグラウンドに落とすためのコンデンサのことである。

これはコンデンサのインピーダンスが1/jwCであらわされることから、十分に高周波なノイズに対しては短絡しているかのようにふるまうことに基づいている。
\subsubsection{電源安定化}
急激な消費電力の変化がある場合には、大容量のコンデンサを設置しておくことで、電源が安定するようにする場合がある。
\subsubsection{電源}
電気二重層コンデンサ(スーパーキャパシタ)などは容量に飽かせて電源として使うこともある。
\subsection{種類}
\subsubsection{アルミ電解コンデンサ}
最も一般的なコンデンサ。電子回路に円筒状の物体があったら大体こいつ。低価格大容量高耐圧だが極性があり、逆電圧をかけると劣化する。

昔は多くのアルミ電解コンデンサが電解液を用いていたために、劣化すると膨らんでいた。(俗に妊娠といわれた)現在は電解質が固体のものも出回っている。見分け方は円筒の上面に十字の切れ込みがあるか否か。電解液の場合には膨らむことができるように十字の切れ込みが入っている。
\subsubsection{セラミックコンデンサ}
アルミ電解コンデンサに劣らないぐらい一般的なコンデンサ。機械研究会の活動範囲ではこちらの方が使用機会が多いかもしれない。

高周波特性がアルミ電解コンデンサより良く安価で、小型化も容易であることからパスコンとして使われることが多い。容量が小さいものしかないことが難点だったが、積層セラミックコンデンサの登場でその状況も変わりつつあり、セラミックコンデンサオンリーで設計される場合も増えている。
\subsubsection{タンタルコンデンサ}
小型かつ大容量で周波数特性もよいことから、オーディオ機器などによく使われるが、高価で極性があり耐圧も低いことが多い。積層セラミックに地位を脅かされつつあるように見える。
\section{トランジスタ}
トランジスタは端的に言えばシリコンで作られた電気的に操作可能なスイッチである。
\subsection{用途}
\subsubsection{スイッチ}
最もよくある使い道。単純に機械的なスイッチの代わりに用いることでマイコンから操作可能なスイッチとすることができる。
\subsubsection{増幅}
トランジスタは現実に存在する素子であるから、理想的なスイッチと違ってオンとオフの間の状態が存在する。その部分を利用することで、小さな入力信号を大きな出力信号として増幅することができる。

主にオーディオ機器などのアナログ回路で利用される。
\subsection{種類}
\subsubsection{バイポーラトランジスタ}
電流によって制御されるトランジスタ。正孔と電子との両方が動作原理にかかわるのでバイポーラと呼ばれる。歴史的には初期に実用化されたトランジスタであり、かつてはトランジスタといえばこれのことを指していた。
\subsubsection{FET}
電圧によって制御されるトランジスタ。正孔と電子のいずれか片方だけが動作原理にかかわるため、ユニポーラトランジスタとも呼ばれる。電界効果トランジスタという名前もある。MOSFETという名称もよく聞くが、MOSは金属酸化物半導体の意であり、使用している材質に起因する名称であるが、近年のFETはほぼすべてMOSFETであり、近年トランジスタといった場合はほぼMOSFETのことである。

パワーMOSFETと呼ばれる、大電力用に設計されたMOSFETも存在する。
\subsubsection{IGBT}
FETとバイポーラトランジスタを組み合わせたような特性を持つ素子である。絶縁ゲートバイポーラトランジスタとも呼ばれる。大電力を高速でスイッチングすることができる。パワーMOSFETとは用途の近さから競争関係にある場合がある。
\section{バッテリー}
機械研究会では電源として商用電源を使わない場合が多いため、バッテリーに関する知識は重要である。
\subsection{用途}
\subsubsection{主電源}
特に説明の必要はないだろう。
\subsubsection{バックアップ電源}
主電源が商用電源など、コードが抜けたりブレーカーが落ちたりして突然寸断したとしても、主電源が復旧するまでの間機器を動かすための電源をバックアップ電源という。

そのような用途で使われるバッテリーは大型の場合UPSなどと呼ばれる。
\subsection{種類}
\subsubsection{単三乾電池}
最も安全で安価な選択肢。交渉電圧は一本あたり1.5V、容量は様々である。海外ではAAバッテリーともいう。主にアルカリとマンガンの二種類があり、アルカリが大電力向け、マンガンが小電力向けなどといわれているが、とりあえずアルカリにしておけば問題はないだろう。

単三電池で動くなら、単三にしておいた方がいい。もちろん、容量が問題なら単一、サイズが問題なら単四あたりを使ってもよい。
\subsubsection{ボタン電池}
容量が小さく小電力向けではあるが、サイズが小さいため小型機器の主電源やバックアップ電源として使われる。
\subsubsection{9V形電池}
角型をした電池で、容量は小さいが9Vという比較的大きな電圧を取り出すことができる。中身としては直列にボタン電池を重ねたようなものが多い。
\subsubsection{NiMHバッテリー}
ニッケル水素充電池ともいう。単三か単四の形をしているものが一般に市販されている。著名なのはエネループである。公称電圧は1.2V。乾電池よりは大電力に耐える。

安全性が高いため、これで済むならこれがよい。
\subsubsection{LiPoバッテリー}
最も危険だが最も高性能なバッテリー。1セル当たり公称電圧3.7V。軽量で大容量。充電器は専用のものを使わないと発火の危険がある。ショートなどが発生すると爆発することもある。廃棄の際も取扱注意。

バランス充電という言葉があるが、あれは複数セルのLiPoバッテリーは内部的には１セルのものが直列で入っているだけであり、粗悪なセルの場合直列のまま充電すると個体差からセルごとに充電され具合が変化してしまい、過放電や過充電の恐れがでてくるため、１セルごとに充電するための仕組みである。高品質なセルであれば直列のまま充電しても問題ないらしいがバランス充電に対応してないものを買うことが少ないので試したことはない。
\subsubsection{18650}
LiPoバッテリーの中でも、直径18mm高さ65mmの円筒型のパッケージをしている１セルのもののことを指す。ほかには26650などサイズ違いのものがある。円筒型のモバイルバッテリーはだいたいこれが入っている。最近では電子タバコの電源もこれであるし、初代テスラものバッテリーもこれをつなげたものである。
\subsubsection{LiFeバッテリー}
LiFeよりは重いが、比較的安全で、性能はそこまで損なわれない。しかし高価である。

予算が許すのであればLiFeを採用するのがよいだろう。
\subsubsection{鉛蓄電池}
鉛蓄電池は広く産業用に用いられており、安全性と実績がある。重量はあるが、LiPoに比して容量当たりの単価が安いため、大容量大電力の用途に向いている。
\section{モータ}
モータは電動機ともよばれ、電気を力学的動力へと変換するための装置の総称である。電源のが直流か交流か、ブラシがあるか否か、フィードバック機能があるか否かなどで分類される。
\subsection{用途}
\subsubsection{動力}
最も一般的な使い方。ほとんどの場合は回転エネルギーとして取り出されるため、モーターの配置やギヤの組み合わせなどによって目的の方向の運動へと変換する必要がある。
\subsubsection{電源}
モーターは可逆的に機能するため、回転エネルギーを電気エネルギーとして取り出すこともできるが、機械研究会で使用することはないだろう。どちらかというと回転エネルギーが電気エネルギーとして取り出されることで回路が焼損するなどの故障原因として直面することになるだろう。
\subsection{ブラシ付きDCモーター}
最も一般的で安価なモーター。かつてはブラシレスモーターが一般的でなかったため、DCモーターといえばこれのことを指していた。単にブラシモーターということも多い。直流電源を整流子とブラシによって切り替えるようなモーターである。義務教育の範囲であるからここでは機構について詳しく述べずにおく。乾電池二本3Vで動作するものからはじまり、24Vなどで動作するような大出力のものもある。一般的にブラシレスのものよりブラシの摩耗がある分短寿命であるといわれているが、機械研究会の活動の範囲程度では大した問題ではないだろう。入手性の良さと電源をつなげば回る単純な構造のため、最初に扱うモーターとしてはよいだろう。
\subsubsection{ブラシレスモーター}
ブラシレスモーターといった場合、文字通りの意味ではブラシのないモーターのことであるが、少なくとも機械研究会の文脈の範囲では、ステッピングモーターを除いた、用途的に上記のブラシ付きDCモーターの上位互換となりうるようなモーター群を指す。DCモーターという言葉だけではブラシ付きDCモーターがあらわされなくなったことから直流電源で動くのだと思われるかもしれないが、正確にはモーター自身は交流(主に三相交流)で動作する。しかし、ブラシレスモーターはESCと呼ばれる、制御用のドライバとセットで運用されることが多く、このESCが直流電源を交流に変えるのも同時に請け負ってくれるため、直流電源で動作するものとして扱われることも多い。

産業的には軽量大出力であることから、ドローンなどでよく採用されている。
\subsubsection{ステッピングモーター}
ステッピングモーターの特徴はオープンループでの高精度な位置決め動作が可能であることである。ブラシレスモーターはサイン波の周波数を変えることによって速度制御のみを行うが、ステッピングモーターではパルス波を入力することで、パルスの回数によって角度を制御し、パルスの間隔によって速度を制御する。ブラシレスモーターと同じくドライバーとセットで使うことが多く、ドライバーがパルス波を生成してくれるため、直流電源で動作するとみなして問題ない。

CNCには一般的にこのモーターが使われる。機械研究会の3Dプリンタもこれを使っている。

サーボモーターに比した欠点として、フィードフォワードであるために脱調した場合には原点復帰動作が必要である。

角型のステッピングモーターはNEMA規格という一辺の長さを基準とした規格によって形状が定められていることが多い。
\subsubsection{サーボモーター}
サーボモーターはエンコーダーを搭載しており、フィードバック制御によって位置決め動作を行う。エンコーダーを搭載していればよいため、動力源となるモーターがブラシ付きかブラシレスかは問わない。

機械研究会で使うサーボは基本的にホビーサーボと呼ばれる、そのサーボモーター用のフィードバック制御用専用ICを内蔵しているサーボを用いるため、位置の指令値さえ与えてやれば動作するものである。速度などのチューニングは基本的に不可能である。

産業用の大出力なものなどはPLC側でフィードバック制御しなければいけないこともある。

位置決め動作について学習するのであれば、SG-90などの9gサーボと呼ばれるサーボモーターから始めるとよいだろう。
\section{マイコン}
マイコンとはマイクロコントローラの略で、コンピュータとして動作するためのCPU、RAM、ROMなどの諸要素と、タイマー、GPIO、UARTなどの組み込み用途に適した要素とをワンチップのパッケージにまとめたものである。パソコンなどが複数のチップを組み合わせることで構成されていることの対比から、電源を除けばワンチップで動作するということを強調してワンチップマイコンという名称を使用することもある。

かつてはマイコンといえば8bitのものがコストなどの面から主流であったが、ARMの登場によって32bitのものも増えつつある。

\subsection{用途}
\subsubsection{制御}
マイコンの主な用途は制御を行うことである。その範囲はモーターの位置決めといった限られた要素からロボットの全体の動作の決定までさまざまである。

マイコンの数は少なければ少ないほど扱いが容易で、特に１つの場合と２つの場合では大きな隔たりがあることから、機械研究会では基本的に１つのマイコンで制御ができるように設計する。
\subsubsection{通信}
特にIoTなど、センサーデータをどこかにシステムの外に送りたい場合にはその通信機能を提供するのもマイコンの仕事である。
\subsubsection{演算}
制御や通信の前段階として、数値計算やデータの整形を行う場合もある。

マイコンでは、浮動小数点演算機を搭載していないこともままあるので、小数点演算の使用には気を付けたほうがよい。
\subsection{種類}
\subsubsection{AVR}
旧Atmel社(Microchip社によって買収)が開発したマイコン群の総称。8bitのものが主である。(32bitのものはARMベースであり、中身はほぼ別物である)

最大の特徴はArduinoというコミュニティベースの開発環境、マイコンボード群で開発可能であることである。

現在最も有名なチップは、Arduinoの開発ボードの主要モデルであるArduino UNOに採用されているATmega 328Pであろう。

最初にいじるマイコンとしては優れている。
\subsubsection{PIC}
Microchip社の製造しているマイコン。特徴として、基本的にどのモデルもディスコン（製造中止）になることがなく、古い情報でも試してみることができることがある。

機械研究会でつかうことはほぼない。
\subsubsection{STM32}
STMicoroelectronics社の32bitのARMベースのマイコン製品群。現在の機械研究会のデファクトスタンダード。AVRに比べ、32bitである上に動作周波数も高いことから演算リソースが多く、ピン数やタイマー数なども多いものが多い。

欠点としては表面実装のものが多いことかもしれないが、大きなデメリットではないだろう。

mbedという統合開発環境と、Nucleoという開発ボードの組み合わせで比較的簡単に開発することができる。Arduinoでもある程度サポートはされているが、十全ではない。STM32の性能をフルに生かしたいのであれば、C++で直接プログラミングすることになるだろうが、ドキュメントの整備具合が2018年3月現在ではあまりにもお粗末なため、茨の道を覚悟した方がよいだろう。
\subsubsection{H8}
日立製作所(現在はルネサスエレクトロニクスとして分離)が開発したマイコン。STM32の前はこれが機械研究会のデファクトスタンダードであった模様。
\subsubsection{Z80}
ゼッパチなどと呼ばれる。インテルの8080コンパチ(互換)のマイコンで命令もほぼバイナリ互換である。

単純にその歴史の長さから使われているように思われるため、やがては消えていくことになるのではないかというのが筆者の私見である。

x86のマイコンが欲しいならLatte Pandaとかminnowboardとか買った方が幸せになれるかも。
\subsubsection{ESP32}
Espressif Systems社のWi-Fi、Bluetoothのコンボチップを搭載したマイコン。最大の特徴は技適を取得したモジュールが容易に手に入ることである。

Arduinoで開発することもできる。
\subsubsection{Raspberry Pi}
正確にはマイコンではないようにも思えるが、マイコン的に使用することも多い。Raspberry Piという名前はSBC(Single Board Computer)という開発ボードといえなくもないもの一種を指しており、チップの名称ではない。Broadcom製のARMSoCを採用している。

Linuxによる抽象化の恩恵、一般的なマイコンに比して強力な演算リソース、USB、LAN、Wi-Fi、Bluetoothなどの比較的高次なインターフェースの統合などがメリットとして挙げられる。

欠点としてはアナログ入出力がないことと、タイマーが一つしかないため、PWMなどが難しいこと、リアルタイム制御が難しいことである。ArduinoかSTM32と組み合わせることを推奨する。
\section{マイコンの機能}
この章ではマイコンが有する各種機能について簡単に説明する。
\subsection{GPIO}
General Purpose Input/Outputの略で、汎用入出力の意である。GPIOはデジタル入出力であり、プログラム上で入力か出力かを選択することができる。大体は入力を割り込みとして処理することができるようになっている。

オンの時に出力される電圧、および入力時にかけても問題ない電圧というのはマイコンごと、場合によってはピンごとに異なるので注意。ほとんどの場合電源電圧とそれらの値は等しい。3.3V駆動のものだと5Vトレラントとデータシートなどに記載されているピンがあることがあるが、これは入力時に5Vをかけても問題ないということである。

GPIOの最高スイッチング速度はものによって異なるが、十分に高速であればソフトウェアの実装によってUARTやPWMなどの他のデジタル機能を実現することも可能である。(基本的にはCPUのリソースを大きく消費するのであまり望ましくはないが、ピン数や配置の問題でやむを得ないこともある)
\subsection{UART}
最も一般的なマイコンの通信インターフェースの一つ。デファクトスタンダードに近いシリアル通信規格であるRS232Cを、プロトコルはそのままに電圧だけをマイコンの駆動電圧まで下げたものである。そのため、レベルシフトを挟むとそのままRS232Cと通信することもできる。

特徴としては一対一でしか通信できないが、仕組みが単純なためほとんどのマイコンに実装されており、ソフトウェアで実装することも可能な点があげられる。

同期信号を送る線を持たないため、ボーレートと呼ばれる通信速度は事前に送受信側の両方に設定しておく必要がある。11520bpsなどが歴史的な経緯によりよく使われる。
\subsection{I$^2$C}
Inter-Integrated Circuitの略で、正式名称としてはアイスクエアドシーと読むが、アイツーシーと読まれることも多い。表記もI2Cと書かれることも少なくない。

特徴としては通信線が２本だけで済むため省配線であること、バス内で固有のアドレスをスレーブに割り振ることで一組の信号線で１対多通信が可能であること、SPIに比べて規格がしっかり決まっており互換性に気を使う必要がない点などがあげられる。欠点としてはSPIに比べると通信速度に限界があることがあげられる。
\subsection{I$^2$S}
Inter IC Soundの略で、I$^2$Cと似ているがあまり関係はない。その名の通り、回路の中で音声信号をやり取りするための規格で、信号線も3本である。
\subsection{SPI}
Serial Peripheral Interfaceの略。信号線は１対１であれば最低３本、I$^2$Cのように１対多で通信したい場合は、通信したい相手の数だけスレーブセレクトを用意するか、デイジーチェーン機能を利用する必要がある。

デイジーチェーン機能は、２つ以上のSPIインターフェースをもつスレーブをバスを共有して接続するのではなく数珠つなぎにし、それぞれのスレーブは受け取った信号を次のスレーブへとそのまま流していき、一番端まで到達したらその時点で持っている信号の内容をそれぞれのスレーブが実施して、出力をそれぞれのスレーブが前のスレーブへと渡していくことで、信号線を少なく保ったまま通信する機能である。

筆者の所感としては、規格が曖昧(特にデイジーチェーン機能は異なるチップをつなげるのが難しそうに見える)なので扱いが難しいが、30Mbpsくらいなら出せそうなので高速なインターフェースが必要な場合に１対１で使うのが良いかと思われる。

QSPIなど、信号線を増やしたり信号線の使い方を変えたりしてさらなる高速化を図った規格も存在する。
\subsection{USB}
Universal Serial Busの略。近年のパソコンにはまず付いている。マイコンでUSBをネイティブに実装しているものは少ない。

パソコンの周辺機器として動作させたい場合や、SPIよりももっと高速に通信したい場合には候補に上がるだろう。

ちなみに、Arduino UnoなどはUSBを持っているように見えるが、あれはUSB-UART変換用のチップを挟んでいるだけである。純正のArduino Uno Rev.3はそのチップとしてATmega 16u2をそのチップとして使っているので、こいつのプログラムを書き換えるとUSB周辺機器として使えるようにできるらしい。
\subsection{内蔵プルアップ/内蔵プルダウン}
\subsection{ADコンバータ}
電圧を読み取って数値に変換してくれる機能。
\subsection{DAコンバータ}
プログラムで指定した数値の電圧を出してくれる機能。電流はほとんど出せないことが多い。
\subsection{JTAG}
Joint Test Action Groupの略。本来は半導体チップの検査用の規格だが、現在ではマイコンのプログラムのデバッグやFPGAへの書き込みなどに利用する。
\subsection{PWM}
Pulse Width Modulationの略。端的に言えば、デジタル信号のオンオフを高速でスイッチングする機能である。ホビーサーボやモータードライバでは指示値を伝達するための通信手段として用いる。LEDなどの輝度を調整するために使うこともある。ローパスフィルターを併用することで簡易的なアナログ出力として使うこともできる。
\section{はんだ付け}
はんだ付けは電子工作における基本的技術である。
\end{document}